<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Eberardos Uploader - Qu.ax</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="https://i.ibb.co/r2KDVBJC/IMG-20241225-WA0318.jpg" type="image/jpeg">
    <style>
        :root{--primary:#e63946;--primary-dark:#d90429;--secondary:#2b2d42;--secondary-light:#414563;--accent:#fca311;--light:#f8f9fa;--dark:#212529;--gray:#8d99ae;--success:#2a9d8f;--error:#e63946}*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins","Segoe UI",Tahoma,Geneva,Verdana,sans-serif}body{background:linear-gradient(135deg,#0c0c0c 0%,#2b2d42 100%);color:var(--light);line-height:1.6;min-height:100vh;padding:0}.container{max-width:1200px;margin:0 auto;padding:20px}header{text-align:center;padding:30px 0;background:rgba(43,45,66,0.8);backdrop-filter:blur(10px);color:white;border-radius:16px;margin-bottom:30px;box-shadow:0 8px 32px rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1);position:relative;overflow:hidden}header::before{content:"";position:absolute;top:0;left:0;width:100%;height:5px;background:linear-gradient(90deg,var(--primary),var(--accent))}.logo{font-size:2.5rem;margin-bottom:15px;color:var(--primary)}h1{font-size:3rem;margin-bottom:10px;font-weight:800;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.upload-section{background:rgba(43,45,66,0.8);backdrop-filter:blur(10px);padding:30px;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.3);margin-bottom:30px;border:1px solid rgba(255,255,255,0.1)}.section-title{font-size:1.8rem;margin-bottom:20px;color:var(--light);position:relative;display:inline-block}.section-title::after{content:"";position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:50px;height:3px;background:var(--primary);border-radius:3px}.upload-area{border:2px dashed var(--gray);border-radius:12px;padding:40px 20px;margin:20px 0;cursor:pointer;transition:all 0.3s ease;background:rgba(33,37,41,0.4)}.upload-area:hover{border-color:var(--primary);background:rgba(230,57,70,0.1);transform:translateY(-5px)}.upload-area.dragover{border-color:var(--primary);background:rgba(230,57,70,0.2)}.upload-icon{font-size:60px;color:var(--primary);margin-bottom:15px}.btn{background:linear-gradient(90deg,var(--primary),var(--primary-dark));color:white;border:none;padding:14px 28px;border-radius:50px;cursor:pointer;font-size:16px;font-weight:600;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(230,57,70,0.4);display:inline-flex;align-items:center;gap:8px}.btn:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(230,57,70,0.6)}.btn:disabled{background:var(--gray);cursor:not-allowed;transform:none}.gallery-section{background:rgba(43,45,66,0.8);backdrop-filter:blur(10px);padding:30px;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.1)}.gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-top:20px}.gallery-item{border-radius:12px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.2);transition:all 0.3s ease;background:rgba(33,37,41,0.6);cursor:pointer}.gallery-item:hover{transform:translateY(-5px)}.gallery-image{width:100%;height:200px;object-fit:cover}.progress-bar{height:10px;background-color:rgba(33,37,41,0.5);border-radius:5px;margin:20px 0;overflow:hidden}.progress{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));width:0%;transition:width 0.3s ease}.status-message{margin:15px 0;font-weight:500;padding:12px;border-radius:8px;text-align:center}.success{background:rgba(42,157,143,0.2);color:var(--success)}.error{background:rgba(230,57,70,0.2);color:var(--error)}.modal{display:none;position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0,0,0,0.9);overflow:auto}.modal-content{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;padding:20px}.modal-image{max-width:90%;max-height:80%;object-fit:contain}.close{position:absolute;top:20px;right:30px;color:white;font-size:40px;cursor:pointer;z-index:1001}@media (max-width:768px){h1{font-size:2.2rem}.gallery-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}.modal-image{max-width:95%;max-height:60%}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo"><i class="fas fa-cloud-upload-alt"></i></div>
            <h1>Ebd Uploader</h1>
            <p>upload foto disini agar tersimpan selamanya ðŸ˜ˆ (powered by qu.ax)</p>
        </header>
        
        <section class="upload-section">
            <h2 class="section-title">Upload Image</h2>
            
            <div class="upload-area" id="upload-area">
                <div class="upload-icon"><i class="fas fa-file-image"></i></div>
                <p>Click or drag an image here to upload.</p>
                <p style="font-size:14px;color:var(--gray)">JPG, PNG, GIF (Max. 5MB)</p>
            </div>
            
            <input type="file" id="file-input" accept="image/jpeg,image/png,image/gif" style="display:none">
            
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            
            <p class="status-message" id="status-message"></p>
            
            <button class="btn" id="upload-btn" disabled>
                <i class="fas fa-upload"></i> Upload
            </button>
        </section>
        
        <section class="gallery-section">
            <h2 class="section-title">Gallery</h2>
            <div class="gallery-grid" id="gallery"></div>
        </section>
    </div>

    <div id="image-modal" class="modal">
        <span class="close">&times;</span>
        <div class="modal-content">
            <img id="modal-image" class="modal-image" src="" alt="">
        </div>
    </div>

    <script>
        const API_URL = '/api/images'; // Backend endpoint
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('upload-btn');
        const progressBar = document.getElementById('progress-bar');
        const statusMessage = document.getElementById('status-message');
        const gallery = document.getElementById('gallery');
        const modal = document.getElementById('image-modal');
        const modalImage = document.getElementById('modal-image');
        const closeBtn = document.querySelector('.close');

        let selectedFile = null;

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length) handleFileSelect(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFileSelect(e.target.files[0]);
        });

        uploadBtn.addEventListener('click', uploadFile);
        closeBtn.addEventListener('click', () => modal.style.display = 'none');
        window.addEventListener('click', (e) => {
            if (e.target === modal) modal.style.display = 'none';
        });

        function handleFileSelect(file) {
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
            const maxSize = 5 * 1024 * 1024;

            if (!allowedTypes.includes(file.type)) {
                return showStatus('Hanya file JPG, PNG, dan GIF yang diperbolehkan', 'error');
            }

            if (file.size > maxSize) {
                return showStatus('Ukuran file maksimal 5MB', 'error');
            }

            selectedFile = file;
            uploadBtn.disabled = false;
            showStatus('File siap diupload', 'success');
        }

        async function uploadFile() {
            if (!selectedFile) return;

            uploadBtn.disabled = true;
            progressBar.style.width = '0%';
            showStatus('Mengupload...', '');

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);

                const response = await fetch(API_URL + '/upload', {
                    method: 'POST',
                    body: formData
                });

                progressBar.style.width = '100%';

                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }

                const data = await response.json();
                showStatus('Upload berhasil!', 'success');
                
                setTimeout(() => {
                    resetUploadForm();
                    loadImages();
                }, 1500);

            } catch (error) {
                console.error('Error:', error);
                showStatus('Error saat upload: ' + error.message, 'error');
                uploadBtn.disabled = false;
            }
        }

        async function loadImages() {
            try {
                gallery.innerHTML = '<div style="grid-column:1/-1;text-align:center"><div class="loading" style="margin:0 auto"></div></div>';

                const response = await fetch(API_URL);
                const images = await response.json();

                gallery.innerHTML = '';

                if (images.length === 0) {
                    gallery.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:var(--gray)">Belum ada gambar</p>';
                    return;
                }

                images.forEach(image => {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.innerHTML = `
                        <img src="${image.quax_url}" alt="${image.original_name}" class="gallery-image">
                        <div style="padding:15px;font-size:0.9rem">
                            <div style="font-weight:600;color:var(--light);margin-bottom:5px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${image.original_name}</div>
                            <div style="color:var(--gray);font-size:0.8rem">${new Date(image.uploaded_at).toLocaleDateString('id-ID')}</div>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        modalImage.src = image.quax_url;
                        modal.style.display = 'block';
                    });

                    gallery.appendChild(item);
                });
            } catch (error) {
                console.error('Error loading images:', error);
                gallery.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:var(--error)">Error memuat galeri</p>';
            }
        }

        function resetUploadForm() {
            uploadArea.innerHTML = `
                <div class="upload-icon"><i class="fas fa-file-image"></i></div>
                <p>Click or drag an image here to upload.</p>
                <p style="font-size:14px;color:var(--gray)">JPG, PNG, GIF (Max. 5MB)</p>
            `;
            fileInput.value = '';
            selectedFile = null;
            uploadBtn.disabled = true;
            progressBar.style.width = '0%';
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = 'status-message';
            if (type) statusMessage.classList.add(type);
        }

        document.addEventListener('DOMContentLoaded', loadImages);
    </script>
</body>
</html>
